//////////////////////////////////////////////////////////////////////////////
/// \defgroup astrings Strings
//@{
/// \file ais_astring.c
///
/// \brief 	Functions for dealing with ais Strings (astring)
///
/// ais Strings are not 0 terminated, that way 0 can also be part of String.
/// First Byte in the ais String contains length of String.\n
/// Maximal String length is limited to 254 + 1
///
/// \author Adam Cwientzek
///
/// \version 0.8
///
/// \date 31.06.2005
///
//////////////////////////////////////////////////////////////////////////////

#include "system/ais_astring.h"


//////////////////////////////////////////////////////////////////////////////
/// Create astring from data
///
/// \param dest Pointer to Destination where astring will be created
/// \param length Length of Data
/// \param data to be stored into astring
///
//////////////////////////////////////////////////////////////////////////////
VMC_UCHAR_8 astring_create(VMC_UCHAR_8 *dest, VMC_UCHAR_8 length, VMC_UCHAR_8 *data) {
//////////////////////////////////////////////////////////////////////////////
 VMC_UINT_16 i;

 if ( length > 254 ) return (1); // Data to long

 for (i=0; i<length; i++) {
  dest[i+1] = data[i]; // Copy Data to destination
 }

 dest[0] = length;  // Set astring length

 return (0); // Return no Error
}
//////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////
/// Copy astring
///
/// \param dest Pointer to Destination where astring will be copied to
/// \param src Pointer to Source astring
///
//////////////////////////////////////////////////////////////////////////////
void astring_copy(VMC_UCHAR_8 *dest, VMC_UCHAR_8 *src) {
//////////////////////////////////////////////////////////////////////////////
 VMC_UINT_16 i;
 dest[0] = src[0];
 if (src[0] > 0)								// if astring not empty
   for (i=1; i<=src[0]; i++) dest[i] = src[i];   // copy content of astring
}
//////////////////////////////////////////////////////////////////////////////



//////////////////////////////////////////////////////////////////////////////
/// Create Astring from Charater
///
/// \param dest Pointer to Destination where astring will be copied to
/// \param src Character
///
//////////////////////////////////////////////////////////////////////////////
void astring_fromChar(VMC_UCHAR_8 *dest, VMC_UCHAR_8 src) {
//////////////////////////////////////////////////////////////////////////////
 dest[0] = 1;
 dest[1] = src;
}
//////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////
/// Calculate length of given astring
///
/// \param astring astring to calculate length
/// \returns Length of given astring
///
//////////////////////////////////////////////////////////////////////////////
VMC_UCHAR_8 astring_len(VMC_UCHAR_8 *astring) {
//////////////////////////////////////////////////////////////////////////////
 return astring[0];
}
//////////////////////////////////////////////////////////////////////////////



//////////////////////////////////////////////////////////////////////////////
/// Convert astring to 0-terminated string
///
/// \param string Pointer to destination where 0-term. string will be created
/// \param astring astring to be converted
///
/// \returns 0 if string was created withoput character conversion\n
///			 Number of converted 0 in astring
///
/// \note all 0 in astring will be converted to '0' (0x30) and the number
///		  of converted 0 will be returned.
///
//////////////////////////////////////////////////////////////////////////////
VMC_UCHAR_8 astring_to_string(VMC_UCHAR_8 *string, VMC_UCHAR_8 *astring) {
//////////////////////////////////////////////////////////////////////////////
 VMC_UCHAR_8 i, count = 0;

 for (i=0; i<astring[0]; i++) {
  string[i] = astring[i+1];
  if ( string[i] == 0 ) {
    string[i] = 0x30;
	count++;
  }
 }

 string[i] = 0;

 return (count);
}
//////////////////////////////////////////////////////////////////////////////



//////////////////////////////////////////////////////////////////////////////
/// Convert 0-terminated string to astring
///
/// \param astring Pointer to destination where astring will be created
/// \param string o-term. string to be converted
///
/// \returns 0 if string was created withoput character conversion\n
///			 1 if 0-term. string was longer than 254 and had to be cutted
///
//////////////////////////////////////////////////////////////////////////////
VMC_UCHAR_8 string_to_astring(VMC_UCHAR_8 *astring, VMC_UCHAR_8 *string) {
//////////////////////////////////////////////////////////////////////////////
 VMC_UCHAR_8 i=0;

 while ( (string[i] > 0) && (i < 254) ) {
  astring[i+1] = string[i];
  i++;
 }

 astring[0] = i;

 if ( (i == 254) && (string[i] != 0) ) return (1);

 return (0);
}
//////////////////////////////////////////////////////////////////////////////

//@}
